# @gusto/embedded-react-sdk - Internal README

To install dependencies:

```bash
npm install
```

To run:

```bash
npm run dev
```

## Local development

### For components

If you just need to develop a component outside of its context within a workflow, you can use [ladle](https://ladle.dev/docs/).

```
npx ladle serve
```

### For workflows

If you need to test your component within the larger context of a workflow, you'll need to setup Zenpayroll + GWS-Flows.

- Follow setup instructions for [Zenpayroll](https://github.com/Gusto/zenpayroll) and start local dev server
  - In another tab run the following commands in Zenpayroll directory(these generate necessary partner account for `gws-flows`) :
  ```
  bundle exec rails runner "DevAccountCreator.new.create_dev_accounts"
  rake partners_api:dev_setup_for_gws_onboarding
  ```
- Follow setup instructions in the readme for [GWS Flows](https://github.com/Gusto/gws-flows)
- Run `npm run dev:setup`; if that fails, follow the instructions below to setup manually:
  - Run `npm link ../gws-flows/node_modules/react` in sdk folder - this is needed to avoid duplicate react instances in local development due to using [npm/yarn link](https://legacy.reactjs.org/warnings/invalid-hook-call-warning.html)
  - In GWS-Flows project folder, run `yarn link -r ../embedded-react-sdk`
- Run `npm run dev`

Now your local changes appear in GWS Flows.

To see the SDK running in GWS Flows, visit it [locally](http://localhost:7777/demos?react_sdk=true) and choose `React SDK (New company)` or `React SDK (Company Onboarded)` under `Select a Type` and click `Create Demo`

Components and Flows will be shown at the top of the page in a `nav`. Company Components will automatically appear as they are added.
Select a Flow or Component to view it

## How to leverage Translations

Translations are stored in [/src/i18n](/src/i18n).

The are broken out by locale (e.g. `en`), then by namespace, which is usually the name of the component they are used in. The source of truth is the `en` locale - the rest will be autogenerated by translation service.

After writing the new translations, run `npm run interface` to generate the types.

In your components, first use `useI18n` hook, which takes in component namespace and loads appropriate resource file into dictionary. After that use the `useTranslation` hook to access the translations in that component and any child components.

## Creating components

### Block components

Block components are focused, reusable components that serve specific functionality. They follow these patterns:

- **Single Purpose**: Each component should generally handle a specific task (e.g., list, form, etc.)
- **Base Component**: Uses [BaseComponent](./src/components/Base/Base.tsx) for consistent behavior and error handling
- **Compound Pattern**: Exposes subcomponents (Head, List, Actions) for flexibility and composition

#### Examples

- [DocumentList](./src/components/Company/DocumentSigner/DocumentList/DocumentList.tsx)
- [LocationForm](./src/components/Company/Locations/LocationForm/LocationForm.tsx)

### Flow components

Flow components compose block components and other flow components together using state machines to manage transitions. They follow these patterns:

- **State Management**: Uses the [Flow](./src/components/Flow/Flow.tsx) component with a state machine to handle transitions
- **Component Composition**: Can compose both block components (e.g., list â†’ form) and other flow components
- **Naming**: Suffix with "Flow" (e.g., `DocumentSigner`, `Locations`)

For example, `EmployeeOnboardingFlow` composes both block components (profile, taxes) and other flow components (document signer) to create a complete onboarding experience.

#### Examples

- [DocumentSigner](./src/components/Company/DocumentSigner/DocumentSigner.tsx)
- [Locations](./src/components/Company/Locations/Locations.tsx)
- [EmployeeSelfOnboardingFlow](./src/components/Flow/EmployeeSelfOnboardingFlow/EmployeeSelfOnboardingFlow.tsx)

## Testing locally

You can run the test suite locally with the following command:

```bash
npm run test
```

## Commits

All commits must follow `commitlint` enforced format: `type(scope?): subject  #scope is optional; multiple scopes are supported (current delimiter options: "/", "\" and ",")`
Following types are currently defined:

```
'build',
'chore',
'ci',
'docs',
'feat',
'fix',
'perf',
'refactor',
'revert',
'style',
'test'
```

[Read more about conventional commits here](https://www.conventionalcommits.org/en/v1.0.0/)

## Documentation

You can find documentation on building with the Gusto Embedded React SDK [in the `docs` directory within this repo here](./docs/01/what-is-the-gep-react-sdk.md). [Documentation is also hosted live alongside the Gusto Embedded API docs here](https://docs.gusto.com/embedded-payroll/docs/what-is-the-gep-react-sdk).

## Cutting a new release

- Get your changes and a version increase in the package.json `version` field into the main branch however you want
- Run `npm i` and commit the new lockfile
- Run the `Publish to NPM` GitHub action [here](https://github.com/Gusto/embedded-react-sdk/actions/workflows/publish.yaml) by clicking `Run workflow`
